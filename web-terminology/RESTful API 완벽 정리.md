---
summary: RESTful API에 대해 정리합니다.
date: 2024-09-11
title-image: 'https://github.com/user-attachments/assets/965f9e27-e930-4068-a2ce-5174a8ecd213'
---

## 철학

결국 유지보수의 용이성을 목적으로 한다.

요청과 응답 데이터 안에 자원과 자원에 접근하고 수정하는 방법을 모두 담는다.
이러한 정보를 담으면서도 간결한 코드를 지향한다.

또한 응답은 클라이언트가 취할 수 있는 다음 액션에 대한 방법을 제공해야 한다.
예를 들어, 블로그 주인이 게시물을 보려고 클릭하면 클라이언트(브라우저)는 게시물에 대한 조회 요청을 한다.
서버는 이 조회 요청에 대한 응답으로 블로그의 데이터(제목, 내용, 마지막 수정 날짜 등)를 전달할 뿐만 아니라 블로그 주인이 다음에 취할 수 있는 액션에 대한 방법도 포함해서 보낸다.
블로그 주인은 게시물을 보고나서, 수정할 수도 있고 삭제할 수도 있고 카테고리를 옮길 수도 있다.
이러한 액션들은 모두 REST 방식으로 기술할 수 있다. URL과 메소드를 정의하면 된다.
서버는 조회에 대한 응답 안에 이러한 액션들을 수행할 수 있는 URL과 메소드를 포함해야 한다.

## 상세

서버와 브라우저(클라이언트) 간 주고 받는 데이터는 "자원"으로 정의한다.
자원은 URI라고도 표현하며, `/posts`, `/categories/어떤 카테고리/posts/포스트아이디`와 같이 URL Path 형식이다.

클라이언트는 자원을 생성 요청, 조회 요청, 수정 요청, 삭제 요청을 할 수 있다. (CRUD라고 한다. Create Read Update Delete)
서버는 클라이언트의 요청을 받고 요청에 대한 작업 결과를 상태 코드로 응답한다. (Status Code라고 한다)
상태 코드는 미리 정해진 응답 유형이다. 404는 조회 요청에 대해 원하는 자원이 없다는 뜻이고, 201은 생성 요청에 대해 성공적으로 자원이 생성됐다는 뜻이다.
이런 식으로 숫자와 그 뜻이 미리 정해져 있다.
그래서 클라이언트는 이 정해진 규칙에 따라 서버가 응답하는 상태 코드를 보고, 요청의 결과가 무엇인지 알 수 있다.

상태코드에 따라 응답 데이터가 있는지 없는지도 알 수 있다. 가령 204(상태코드 이름: No Content)의 경우 상태코드 이름에서도 알 수 있듯 응답 데이터가 없다는 뜻을 포함하고 있으며,
반대로 200(OK)의 경우에는 일반적으로 응답 데이터가 포함된다.

## 레벨

REST는 실용적인 관점에서 여러 가지 수준으로 나눈다.

레벨이 높을수록 좀 더 규칙을 잘 준수하는 것이고, 낮을수록 REST의 철학과 의도와는 멀어진다.

Level 1: 자원 개념을 사용한다.
Level 2: Level 1에 더해서 메소드와 상태코드 개념을 사용한다.
Level 3: Level 2에 더해서 Hateoas 개념을 사용한다.


자원을 정의할 때는 복수형을 쓴다. 게시물이라는 자원은 post 같은 단수형이 아니라 posts로 정의한다.
GET /posts 라는 것은 게시물 리스트를 조회한다는 뜻이지, 하나의 게시물을 조회하라는 뜻이 아니기 때문이다.
하나의 게시물을 조회하려면 GET /posts/1과 같이 게시물 아이디를 붙인다. posts 중에 1번 포스트라는 뜻이다.

포스트에 대한 액션은 /posts/new와 같이 path에 적지 않고, 가능하면 메소드로 표현한다.
자원에 대해 취해질 수 있는 여러 가지 액션이 이미 정해져 있다.
생성은 POST, 삭제는 DELETE, 부분 수정은 PATCH, 전체 수정은 PUT, 조회는 GET이다.
따라서 포스트를 생성하는 요청은 /posts/new가 아니라 POST /posts가 되어야 한다.

요청에 대한 응답은 성공과 실패로 나뉜다. 성공을 나타내는 상태코드는 200번대이며, 실패는 400~500번대이다.
또한 성공이나 실패 모두 클라이언트에게 추가적으로 전달해야 할 정보가 있을 수 있다.
실패 쪽이 좀 더 떠올리기 쉬운데, 주로 요청이 왜 실패했는지에 대한 정보이다.
실패의 유형에는 사용자가 잘못된 정보로 요청했을 경우, 서버에서 미지의 원인 때문에 문제가 발생한 경우로 나뉜다.
전자의 상태코드는 400번대이고 후자의 상태코드는 500번대이다.
사용자의 잘못된 정보로 인한 실패에서도 여러 가지 세부 유형이 있을 수 있다.
가령 사용자가 기입한 정보에서 오류가 있다든가, 사용자가 해당 요청을 할 권한이 없다든가, 여러 가지 유형이 있을 수 있다.
이러한 세부 유형을 모두 리스트업해서 상태코드에 정의했다.
그래서 클라이언트는 서버가 전달한 상태코드를 보고 요청에 대한 응답이 성공했는지 실패했는지 여부와 또한 실패했다면 어떤 점이 문제였는지를 알 수 있다.


## 메소드

### GET

자원을 조회한다.
요청 본문은 포함하지 않는다.

멱등성을 보장한다.

<MessageBox title='멱등성' level='info'>
  요청을 한 번 하는 것과 여러 번 연속으로 하는 것이 동일한 결과를 가질 때 멱등성이 성립한다고 한다.

  name을 "kim"에서 "lee"로 바꿔치는 요청은 멱등성이 성립한다.
  바꿔치는 작업을 한 번 하나, 10번 하나 결과는 name이 "lee"가 되기 때문이다.

  그런데 money를 10000씩 증가시키는 요청은 멱등성이 성립하지 않는다.
  money를 증가시키는 작업을 한 번 하면 +10,000이지만 10번 하면 +100,000이기 때문이다.
</MessageBox>

### POST

자원을 생성한다.
요청 본문을 포함한다.

멱등성은 보장되지 않는다.

요청 응답은 내 경우에 보통 201(Created)를 사용한다. 201과 함께 생성된 자원을 URI 형태로 함께 전달한다.

### PUT

자원을 전체 수정한다.
요청 본문을 포함한다.

멱등성을 보장한다. 매 요청은 그 요청의 본문으로 자원을 전체 수정하기 때문이다.

하나라도 새 자원을 만들었다면 201 상태코드를 반환한다.
요청 본문으로 잘 수정했다면 204나 200 상태코드를 반환한다.

### PATCH

자원을 부분 수정한다.
요청 본문을 포함한다.

멱등성을 보장하지 않는다. 단순히 자원의 부분을 교체하는 것이 아니라 더하고 빼는 연산 작업 등을 허용하는 메소드이기 때문이다.

200번대 상태코드를 반환한다.
요청 본문으로 잘 수정했다면 204나 200 상태코드를 반환한다.

### DELETE

자원을 삭제한다.
요청 본문을 포함하지 않는다.

멱등성을 보장한다.

응답은 아마도 성공적으로 수행할 것 같으나 아직 실행하지 않은 경우 202(Accept)를 쓰고,
성공적으로 실행했고 응답 본문이 없는 경우 204(No Content)를 쓰고,
성공적으로 실행했고 응답 본문이 있는 경우 200(OK)를 쓴다.

여기서 202 상태코드의 경우 Soft Delete에 해당한다.
삭제 요청이 오면 해당 자원에 대해 삭제 처리됐음을 마킹만 하고, 정책에 따라 내부적으로 통계나 빅데이터 분석 등에 활용한 뒤 데이터가 쓸모없어지게 되거나 법적 사용 기한이 만료되면 실제로 삭제하는 식이다.

DELETE는 권한과 함께 수행되어야 한다.
대표적인 방법으로 Authorization 헤더에 권한 정보를 넣는다.
Authorization 헤더에 Bearer 키워드와 함께 토큰을 넣는다.

## 상태 코드

- 200(OK)
  - GET: 메시지 본문에 리소스가 포함되었다
  - POST: 요청이 성공했고 작업 결과가 본문에 포함되었다
- 201(Created)
  - 자원이 생성되었다.
  - 본문에 생성된 자원과 링크를 포함한다.
  - Location 헤더에 자원의 링크를 넣는다.
- 202(Accepted)
  - 요청이 수락되었으나 실행 처리가 시작되지 않았거나 실행중인 상태이다.
  - 다른 서버에서 실행하거나 배치 처리가 목적이다.
- 204(No Content)
  - 요청이 성공했으나 다른 페이지로 이동하지 않아도 된다.
  - 예를 들어, 편집기에 "저장 후 계속" 버튼을 누르면 요청이 성공하더라도 계속 편집기 페이지에 남아 있어야 한다.
- 205(Reset Content)
  - 요청이 성공했고, 클라이언트에서 기입한 데이터를 초기화한다. (새로 고침)
- 400(Bad Request)
  - 클라이언트의 오류로 작업을 성공적으로 수행하지 못했다.
- 401(Unauthorized)
  - 자원에 대한 클라이언트의 유효한 권한이 없어서 요청을 수행하지 못했다.
- 403(Forbidden)
  - 401과 유사함. 차이점은 재인증을 해도 지속적으로 요청을 거부한다.
- 404(Not Found)
  - 자원을 찾을 수 없다.
- 405(Method Not Allowed)
  - 서버가 요청 메소드를 알고 있지만 해당 자원에 대한 요청 메소드를 지원하지 않는다.
  - 응답에 Allow 헤더에 허용하는 메소드를 담는다.
- 408(Request Timeout)
  - 사용하지 않는 연결을 끊는다.
  - 응답에 Connection 헤더에 "close"를 담아야 한다.
- 409(Conflict)
  - 서버의 현재 상태와 요청이 충돌한다.
  - 버전 관리 중인 파일에 대해 이전 파일로 PUT 요청을 하면 409 응답을 보낼 수 있다.
- 410(Gone)
  - 자원이 영구적으로 삭제되었다.
  - 일시적인지 영구적인지 모르는 경우 404를 사용한다.
- 422(Unprocessable Content)
  - 서버가 요청 본문 형식을 이해했고, 문법도 올바르지만 요청을 수행할 수 없다.
  - 내 경우에 validation에서 통과하지 못한 경우 이 응답 코드를 보낸다. (예를 들어 회원 가입할 때 다른 사람이 사용중인 이메일로 가입하려는 경우)
